<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Корзина — HandMarket</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <header class="site-header small">
    <div class="container header-row">
      <div class="brand">HandMarket <span class="accent">KZ</span></div>
      <div class="controls">
        <a href="index.html" class="btn btn-outline">Главная</a>
      </div>
    </div>
  </header>

  <main class="container" style="padding:24px 16px">
    <h1>Корзина</h1>
    <div class="cart-page card" style="padding:12px">
      <div id="cartItems"></div>

      <div id="cartEmpty" class="empty">Ваша корзина пуста</div>

      <div id="cartSummary" class="cart-summary hidden">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>Итого: <strong id="cartTotal">0</strong> ₽</div>
          <div>
            <button id="checkout" class="btn btn-primary">Оформить заказ</button>
            <button id="clearCart" class="btn btn-outline">Очистить</button>
          </div>
        </div>
      </div>
    </div>
  </main>

  <footer class="site-footer">
    <div class="container footer-row">
      <div>© HandMarket — учебный проект</div>
    </div>
  </footer>

  <script src="script.js"></script>
  <script>
    // Cart page specific logic: render and interactive controls
    document.addEventListener('DOMContentLoaded', () => {
      const cartItems = document.getElementById('cartItems');
      const cartEmpty = document.getElementById('cartEmpty');
      const cartSummary = document.getElementById('cartSummary');
      const cartTotal = document.getElementById('cartTotal');
      const clearCartBtn = document.getElementById('clearCart');
      const checkoutBtn = document.getElementById('checkout');

      const getCart = () => JSON.parse(localStorage.getItem('hm_cart') || '[]');
      const saveCart = (c) => localStorage.setItem('hm_cart', JSON.stringify(c));

      function render() {
        const cart = getCart();
        if (!cart || cart.length === 0) {
          cartItems.innerHTML = '';
          cartEmpty.style.display = 'block';
          cartSummary.classList.add('hidden');
          return;
        }

        cartEmpty.style.display = 'none';
        cartSummary.classList.remove('hidden');

        cartItems.innerHTML = '';
        let total = 0;
        cart.forEach((item, idx) => {
          const block = document.createElement('div');
          block.className = 'cart-row';
          block.style.display = 'flex';
          block.style.gap = '12px';
          block.style.alignItems = 'center';
          block.style.padding = '12px 0';
          block.innerHTML = `
            <img src="${item.image || 'https://via.placeholder.com/120'}" style="width:90px;height:64px;object-fit:cover;border-radius:6px" alt="">
            <div style="flex:1">
              <div style="font-weight:600">${item.name}</div>
              <div class="muted">${item.price} ₽</div>
              <div style="margin-top:8px">
                <button class="btn qty-dec" data-idx="${idx}">-</button>
                <span style="margin:0 8px" class="qty">${item.qty}</span>
                <button class="btn qty-inc" data-idx="${idx}">+</button>
                <button class="btn btn-sm remove" data-idx="${idx}" style="margin-left:12px">Удалить</button>
              </div>
            </div>
            <div style="min-width:90px;text-align:right;font-weight:700">${(Number(item.price.toString().replace(/\s/g,'')) * item.qty).toLocaleString('ru-RU')} ₽</div>
          `;
          cartItems.appendChild(block);
          total += Number(item.price.toString().replace(/\s/g,'')) * item.qty;
        });
        cartTotal.textContent = total.toLocaleString('ru-RU');
      }

      // events
      cartItems.addEventListener('click', (e) => {
        const idx = e.target.dataset?.idx;
        if (!idx && idx !== "0") return;
        let cart = getCart();
        const i = Number(idx);
        if (e.target.classList.contains('qty-inc')) {
          cart[i].qty += 1;
          saveCart(cart); render();
        } else if (e.target.classList.contains('qty-dec')) {
          if (cart[i].qty > 1) cart[i].qty -= 1;
          else cart.splice(i,1);
          saveCart(cart); render();
        } else if (e.target.classList.contains('remove')) {
          cart.splice(i,1);
          saveCart(cart); render();
        }
        // ensure header count updates (script.js also handles)
        window.dispatchEvent(new Event('storage'));
      });

      clearCartBtn.addEventListener('click', () => { localStorage.removeItem('hm_cart'); render(); window.dispatchEvent(new Event('storage')); });
      checkoutBtn.addEventListener('click', () => { alert('Оформление — демонстрация.'); });

      render();
    });
  </script>
</body>
</html>
